---
title: "Brain stroke"
output: html_notebook
editor_options: 
  markdown: 
    wrap: 72
---

```{markdown}




Goal of collecting this Dataset

Our goal of collecting a dataset about brain stroke is to gather
relevant and accurate information about this medical condition by
gathering information about the patients health history,age and
gender.This data will help enhancing patient care so that researchers
and healthcare professionals can gain knowledge of the risk factors
,causes, age rating of patients and symptoms associated with brain
stroke.

Classification goal:

We want to classify the patients to be able to accurately predict
whether a patient will have a stroke or not based on age, medical
history and gender. Using this classification we can help in early
identification and prevention of strokes ,this would help us for a
better patient care.

Clustering goal:

The goal of clustering is to identify patterns or groupings within the data that can help in better understanding the risk factors of brain stroke. It can help to categorize similar cases or patients, which might be useful for research, diagnosis and treatment planning.

The Problem statement:
To use data mining techniques to help researchers for early detection, risk assessment, and improved understanding of brain strokes, explore the given dataset on brain stroke and develop a predictive model that can identify the key risk factors associated with stroke. Specifically, the project aims to:

1. Perform exploratory data analysis to gain insights into the distribution and characteristics of the variables in the dataset.
2. Identify the most significant variables and their relationships with stroke occurrence using statistical analysis and data visualization techniques.
3. Preprocess the dataset by handling missing values, outliers, and categorical variables, ensuring data quality and consistency.
4. Select appropriate data mining techniques, such as classification algorithms, to build a predictive model for stroke risk assessment.



The source

The dataset was sourced from kaggle website The link:
[here](https://www.kaggle.com/datasets/jillanisofttech/brain-stroke-dataset).

General information

Number of Attributes: 11, Number of Objects: 4982, Class label: brain
stroke status 1 if the patient had a stroke 0 if not.

1)  gender: "Male", "Female"

2)  age: age of the patient

3)  hypertension: 0 if the patient doesn't have hypertension, 1 if the
    patient has hypertension

4)  heart disease: 0 if the patient doesn't have any heart diseases, 1
    if the patient has a heart disease

5)  Ever-married: "No" or "Yes"

6)  work type: "children", "Govt_job", "Never worked", "Private" or
    "Self-employed"

7)  Residence type: "Rural" or "Urban"

8)  avg glucose level: average glucose level in blood

9)  BMI: body mass index

10) smoking_status: "formerly smoked", "never smoked", "smokes" or
    "Unknown"

11) stroke: 1 if the patient had a stroke or 0 if not

    | attribute name    | data type | description                                      | possible values                                                      |
    |-----------------|-----------------|---------------------|-----------------|
    | gender            | string    | Gender of the patient (e.g., Male, Female).      | Male, Female                                                         |
    | Age               | decimal   | Patient's age in years at the time of assessment | 0.08 to 82                                                           |
    | hypertension      | integer   | if the patient has hypertension                  | 0 or 1                                                               |
    | heart disease     | integer   | if the patient has heart disease                 | 0 or 1                                                               |
    | Residence type    | string    | the residence type of the patient                | "Rural" or "Urban"                                                   |
    | Ever-married      | string    | if the patient has ever married or not           | "No" or "Yes"                                                        |
    | work type         | string    | the work type of the patient                     | "children", "Govt_job", "Never worked", "Private" or "Self-employed" |
    | avg glucose level | decimal   | average glucose level in blood                   | 55.1 - 272                                                           |
    | BMI               | decimal   | Body Mass Index (BMI) of the patient.            | 14 - 48.9                                                            |
    | smoking status    | string    | the smoking status of the patient                | "formerly smoked", "never smoked", "smokes" or "Unknown"             |
    | stroke            | integer   | if the patient had a stroke or not               | 0 or 1   |

```

**Load dataset**

```{r}


library(readr)
brain_stroke <- read_csv("brain_stroke.csv")
View(brain_stroke)

```

**Load necessary libraries**

```{r}

library(dplyr)
library(ggplot2)
library(outliers)

```

**Number of rows**

```{r}

nrow(brain_stroke)

```

**Number of columns**

```{r}

 ncol(brain_stroke)

```

**Sample of raw dataset**

```{r}
head(brain_stroke,n=10)

```

**Missing values**

```{r}

is.na(brain_stroke)
sum(is.na(brain_stroke))

```

The output is 'false,' which suggests that there are no missing
elements in our dataset

**Statistical summaries**

```{r}

summary(brain_stroke$age)
```
The age ranges from a minimum of 0.08 to a maximum of 82.00, with most values concentrated between the first quartile (25.00) and the third quartile (61.00) and The median age is 45.00, and the mean age is approximately 43.42 , it is relatively wide age range with a skewed distribution towards older ages



```{r}
summary(brain_stroke$avg_glucose_level)
```
The average glucose levels shows that they range from a minimum of 55.12 to a maximum of 271.74, with a median value of 91.85 and a mean of 105.94, Most values are concentrated between the first quartile (77.23) and the third quartile (113.86), This suggests some variability in glucose levels, with a slightly right-skewed distribution.

```{r}
summary(brain_stroke$bmi)
```
the BMI data has a minimum value of 14.0 and a maximum of 48.9, with the median BMI being 28.1 and the mean approximately 28.5, The majority of values fall between the first quartile (23.7) and the third quartile (32.6), This indicates a range of BMI values with a distribution that appears to be somewhat right-skewed.


```{r}
var(brain_stroke$age)
```
The variance of age in your dataset is 513.6005, This measures the spread or variability in age values, A higher variance suggests a wider dispersion of ages in the dataset, indicating greater variability.


```{r}
var(brain_stroke$avg_glucose_level)
```
The variance of average glucose levels is 2031.789, This high variance suggests a considerable amount of variation in glucose levels among the individuals in the dataset.


```{r}
var(brain_stroke$bmi)
```
The variance of BMI is 46.1104,it indicates a moderate amount of variability in BMI values within the dataset.

## **Boxplots**

**boxplot of age**

boxplot to visualize the distribution of ages in our dataset, it
includes the median, quartiles, and potential outliers of
the age variable.

```{r}
 boxplot.stats(brain_stroke$age)$out
 boxplot(brain_stroke$age)

```

**boxplot of avg_glucose_level**

boxplot to visualize the distribution of avg_glucose_level in our
dataset, it includes the median, quartiles, and potential outliers of
the avg_glucose_level variable.

```{r}
boxplot.stats(brain_stroke$avg_glucose_level)$out
boxplot(brain_stroke$avg_glucose_level)

```

#boxplot of bmi 

a boxplot to visualize the distribution of bmi
in our dataset, it includes the median, quartiles, and potential
outliers of the bmi variable.
```{r}
boxplot.stats(brain_stroke$bmi)$out
boxplot(brain_stroke$bmi)
```

## **histogram**

**Shows Distribution of ages**

```{r}
hist(brain_stroke$age, col = "purple", main = "Age Distribution", xlab
= "Age")

```

We notice from this histogram that the majority of people in this
dataset are between the ages of 40 to 60

## **Scatter plot**

**Shows the relationship between two attributes: "average glucose level"
(on the x-axis) and "BMI" (Body Mass Index, on the y-axis)**

```{r}
ggplot(brain_stroke, aes(x = avg_glucose_level, y = bmi)) +
geom_point() + labs(title = "Scatter Plot: BMI & average glucose level")

cor(brain_stroke$avg_glucose_level, brain_stroke$bmi)


```

[1] 0.1863482 Based on the scatter plot and the correlation number We
noticed that the correlation between the two attributes is very weak
because the correlation is between 0 and 0.199.

## Pie charts

**Shows Distribution of Residence Types**

```{r}
tab <- table(brain_stroke$Residence_type)

percentages <- prop.table(tab) * 100

txt <- paste0(names(tab), '\n', round(percentages, 3), '%')

pie(tab, labels = txt)

```

We notice from this pie chart that the majority of people in this
dataset live in urban residence

## **Bar Plots**

### 1 - Shows the disturbution of work type

```{r}


library(ggplot2)

# Assuming you have a data frame named 'brain_stroke'

# Define a custom color palette
my_colors <- c("pink", "lightblue", "lightgreen", "purple")  # You can add more colors as needed

ggplot(brain_stroke, aes(x = work_type, fill = work_type)) +
  geom_bar(color = "black", fill = my_colors) +
  labs(title = "Bar Plot: Distribution of Work Type")





```

We notice from this bar plot that the majority of people in this dataset
work for a private organization.

After encoding, 'Children' will be number 1, 'Govt_job' will be number
2, 'Private' will be number 3, and 'Self-employed' is number 4.

### 2 - The resulting plot visually shows the distribution of heart disease cases and their association with brain stroke.

```{r}


library(ggplot2)
library(dplyr)

percentages <- brain_stroke %>%
  group_by(heart_disease, stroke) %>%
  summarize(count = n(), .groups = "drop") %>%
  mutate(percentage = (count / sum(count)) * 100)

ggplot(brain_stroke, aes(x = factor(heart_disease), fill = stroke)) +
  geom_bar() +
  geom_text(data = percentages, aes(label = paste0(round(percentage, 1), "%"), y = count), 
            position = position_stack(vjust = 0.5)) +
  labs(x = "Heart Disease", y = "Count", fill = "Stroke") +
  scale_x_discrete(labels = c("No Heart Disease", "Heart Disease")) +
  ggtitle("Barplot of Heart Disease and Stroke") +
  theme_minimal()
 


```

The perecentage at the top of the column shows the percentage of having
a brain stroke #We notice from this bar plot that people with heart
disease have a higher risk of experiencing a brain stroke

### 3 - The resulting plot visually shows the distribution of hypertension cases and their association with brain stroke.

```{r}



percentages <- brain_stroke %>%
  group_by(hypertension, stroke) %>%
  summarize(count = n()) %>%
  mutate(percentage = (count / sum(count)) * 100)

ggplot(brain_stroke, aes(x = factor(hypertension), fill = stroke)) +
  geom_bar() +
  geom_text(data = percentages, aes(label = paste0(round(percentage, 1), "%"), y = count), 
            position = position_stack(vjust = 0.5)) +
  labs(x = "Hypertension", y = "Count", fill = "Stroke") +
  ggtitle("Barplot of Hypertension and Stroke") +
  scale_x_discrete(labels = c("No Hypertension", "Hypertension")) +  # Custom labels
  theme_minimal()


```

The perecentage at the top of the column shows the percentage of having
a brain stroke #We notice from this bar plot that people with
hypertension have a higher risk of experiencing a brain stroke.

### 4 - bar blot that helps visualize if there is any association between smoking status and the likelihood of experiencing a stroke.

```{r}

percentages <- brain_stroke %>%
  group_by(smoking_status, stroke) %>%
  summarize(count = n()) %>%
  mutate(percentage = (count / sum(count)) * 100)

ggplot(brain_stroke, aes(x = smoking_status, fill = stroke)) +
  geom_bar() +
  geom_text(data = percentages, aes(label = paste0(round(percentage, 1), "%"), y = count), 
            position = position_stack(vjust = 0.5)) +
  labs(x = "Smoking Status", y = "Count", fill = "Stroke") +
  ggtitle("Distribution of Smoking Status in Relation to Stroke") +
  theme_minimal()

```

The perecentage at the top of the column shows the percentage of having
a brain stroke We notice from this bar plot that people who formerly
smoked and smokes have a higher risk of experiencing a brain stroke.

## Outliers

```{r}

library(outliers)

Outavg_glucose_level = outlier(brain_stroke$avg_glucose_level, logical =TRUE) 
sum(Outavg_glucose_level) 
Find_outlier = which(Outavg_glucose_level ==TRUE, arr.ind = TRUE) 
Outavg_glucose_level 
Find_outlier

Outbmi = outlier(brain_stroke$bmi, logical =TRUE) 
sum(Outbmi) 
Find_outlier = which(Outbmi ==TRUE, arr.ind = TRUE) 
Outbmi 
Find_outlier

Outage = outlier(brain_stroke$age, logical =TRUE) 
sum(Outage) 
Find_outlier = which(Outage ==TRUE, arr.ind = TRUE) 
Outage 
Find_outlier


```

By removing outliers, we improve the overall quality and accuracy of the
dataset. We detected and identified outliers in the "avg_glucose_level,"
"bmi," and "age" columns of the "brain_stroke" dataset ,This helps
ensure that the data reflects the true relationships.

### Normalization

```{r}

normalize <- function(x) {return ((x - min(x)) / (max(x) - min(x)))}
dataWithoutNormalization <- brain_stroke
brain_stroke$bmi<-normalize(dataWithoutNormalization$bmi) 
brain_stroke$age<-normalize(dataWithoutNormalization$age) 
brain_stroke$avg_glucose_level<-normalize(dataWithoutNormalization$age) 
print(brain_stroke)

```

### Discretization

```{r}
 
#we do not need feature discretization because the data is already well-preprocessed.
```

## Feature selection

### correlation

```{r}
#feature selection - correlation analysis (numric)
cor(brain_stroke$age, brain_stroke$stroke)
cor(brain_stroke$bmi, brain_stroke$stroke)
cor(brain_stroke$hypertension, brain_stroke$stroke)
cor(brain_stroke$heart_disease, brain_stroke$stroke)
cor(brain_stroke$avg_glucose_level, brain_stroke$stroke)
```

There's a weak correlations between numerical attributes (typically
below 0.3) . This implies that feature selection isn't necessary.

### Chi square

```{r}
#feature selection - chi square (cateorigal)

chi_squared_result <-
chisq.test(table(brain_stroke$gender, brain_stroke$stroke))
print(chi_squared_result)

chi_squared_result <-
chisq.test(table(brain_stroke$work_type, brain_stroke$stroke))
print(chi_squared_result)

chi_squared_result <-
chisq.test(table(brain_stroke$Residence_type, brain_stroke$stroke))
print(chi_squared_result)

chi_squared_result <-
chisq.test(table(brain_stroke$smoking_status, brain_stroke$stroke))
print(chi_squared_result)

chi_squared_result <-
chisq.test(table(brain_stroke$ever_married, brain_stroke$stroke))
print(chi_squared_result)
```

After each test, the result is used to display the chi-squared test
result, including the chi-squared statistic, degrees of freedom, by
comparing chi-square value with the DF in the probability level table,
it showed that the attributs "work_type", "smoking_status",
"ever_married" have a greater chi square value than DF value.

### Delete

```{r}


# Remove specific columns from the data frame
data <- data[, !names(data) %in% c("work_type", "smoking_status", "ever_married")]
head(brain_stroke)


```

### Encoding and scaling

#### Data types should be transformed into numeric types before clustering.

```{r}
#Encoding

brain_stroke$work_type = factor(brain_stroke$work_type,levels = c("Govt_job","Private", "Self-employed"
,"children","Never_worked"), labels = c(5,4,3,2,1))

brain_stroke$gender = factor(brain_stroke$gender, levels = c("Male", "Female"), labels = c(1, 2))

brain_stroke$ever_married= factor(brain_stroke$ever_married, levels = c("No", "Yes"), labels = c(0, 1))

brain_stroke$Residence_type = factor(brain_stroke$Residence_type, levels = c("Urban", "Rural"), labels = c(1, 2))


brain_stroke$smoking_status = factor(brain_stroke$smoking_status, levels = c("Unknown", "never smoked", "formerly smoked", "smokes"), labels = c(1, 2, 3, 4))


#encoding الي ضبط الاكواد

brain_stroke$gender <- as.numeric(brain_stroke$gender)
brain_stroke$ever_married <- as.numeric(brain_stroke$ever_married)
brain_stroke$work_type <- as.numeric(brain_stroke$work_type)
brain_stroke$Residence_type <- as.numeric(brain_stroke$Residence_type)
brain_stroke$smoking_status <- as.numeric(brain_stroke$smoking_status)
```

```{r}
View(brain_stroke)
data("brain_stroke")
summary(brain_stroke)
str(brain_stroke)
```

##scale 
```{r}

# Define the columns you want to scale
columns_to_scale <- c("age", "avg_glucose_level", "bmi")


brain_stroke[columns_to_scale] <- scale(brain_stroke[columns_to_scale])
View(brain_stroke)
```

## Clustering

### K= 2 Clusters

```{r}
# run k-means clustering to find 2 clusters
#set a seed for random number generation  to make the results reproducible
set.seed(8953)
kmeans.result <- kmeans(brain_stroke, 2)
# print the clusterng result
kmeans.result

```

#### visualize 2 clusters

```{r}

# visualize clustering (2 clusters)
install.packages("factoextra")
library(factoextra)
fviz_cluster(kmeans.result, data = brain_stroke)
```

```{r}
#average silhouette for each clusters (2 clusters)
library(cluster)
avg_sil <- silhouette(kmeans.result$cluster,dist(brain_stroke)) #a dissimilarity object inheriting from class dist or coercible to one. If not specified, dmatrix must be.
fviz_silhouette(avg_sil)#k-means clustering with estimating k and initializations

```

### K= 3 clusters

```{r}
# run k-means clustering to find 3 clusters
#set a seed for random number generation  to make the results reproducible
set.seed(8953)
kmeans.result <- kmeans(brain_stroke, 3)
# print the clusterng result
kmeans.result

```

#### visualize 3 clusters

```{r}

# visualize clustering (3 clusters)
install.packages("factoextra")
library(factoextra)
fviz_cluster(kmeans.result, data = brain_stroke)
```

```{r}
#average silhouette for each clusters (3 clusters)
library(cluster)
avg_sil <- silhouette(kmeans.result$cluster,dist(brain_stroke)) #a dissimilarity object inheriting from class dist or coercible to one. If not specified, dmatrix must be.
fviz_silhouette(avg_sil)#k-means clustering with estimating k and initializations

```

### K= 4 clusters

```{r}
# run k-means clustering to find 4 clusters
#set a seed for random number generation  to make the results reproducible
set.seed(8953)
kmeans.result <- kmeans(brain_stroke, 4)
# print the clusterng result
kmeans.result

```

#### visualize 4 clusters

```{r}

# visualize clustering (4 clusters)
install.packages("factoextra")
library(factoextra)
fviz_cluster(kmeans.result, data = brain_stroke)
```

```{r}
#average silhouette for each clusters (4 cluster)
library(cluster)
avg_sil <- silhouette(kmeans.result$cluster,dist(brain_stroke)) #a dissimilarity object inheriting from class dist or coercible to one. If not specified, dmatrix must be.
fviz_silhouette(avg_sil)#k-means clustering with estimating k and initializations
```

### K= 5 clusters

```{r}
# run k-means clustering to find 5 clusters
#set a seed for random number generation  to make the results reproducible
set.seed(8953)
kmeans.result <- kmeans(brain_stroke, 5)
# print the clusterng result
kmeans.result

```

#### visualize 5 clusters

```{r}

# visualize clustering (5 clusters)
install.packages("factoextra")
library(factoextra)
fviz_cluster(kmeans.result, data = brain_stroke)
```

```{r}
#average silhouette for each clusters 
library(cluster)
avg_sil <- silhouette(kmeans.result$cluster,dist(brain_stroke)) #a dissimilarity object inheriting from class dist or coercible to one. If not specified, dmatrix must be.
fviz_silhouette(avg_sil)#k-means clustering with estimating k and initializations

```

### K= 6 clusters

```{r}
# run k-means clustering to find 6 clusters
#set a seed for random number generation  to make the results reproducible
set.seed(8953)
kmeans.result <- kmeans(brain_stroke, 6)
# print the clusterng result
kmeans.result

```

#### visualize 6 clusters

```{r}

# visualize clustering (6 clusters)
install.packages("factoextra")
library(factoextra)
fviz_cluster(kmeans.result, data = brain_stroke)
```

```{r}
#average silhouette for each clusters 
library(cluster)
avg_sil <- silhouette(kmeans.result$cluster,dist(brain_stroke)) #a dissimilarity object inheriting from class dist or coercible to one. If not specified, dmatrix must be.
fviz_silhouette(avg_sil)#k-means clustering with estimating k and initializations
```

### Within cluster sums of squares

```{r}
# 3- Elbow method بطريقة السلايدز
#fviz_nbclust() with within cluster sums of squares (wss) method
library(factoextra) 
fviz_nbclust(brain_stroke, kmeans, method = "wss") +
  geom_vline(xintercept = 4, linetype = 2)+
  labs(subtitle = "Elbow method")
```

```{r}
#بطريقة اليوتيوب
library(factoextra) 
fviz_nbclust(brain_stroke, kmeans, method = "wss")
```

```{r}
#trying wws طريقة اخرى

wssplot <- function(data, nc = 15, seed = 1234) {
  wss <- (nrow(data) - 1) * sum(apply(data, 2, var))
  for (i in 2:nc) {
    set.seed(seed)
    wss[i] <- sum(kmeans(data, centers = i)$withinss)
  }
  plot(1:nc, wss, type = "b", xlab = "Number of Clusters", ylab = "Within groups sum of squares")
  wss
}

# Call the function with your dataset 'brain_stroke'
result <- wssplot(brain_stroke)
```

### Average Silhouette

```{r}
#طريقة اليوتيوب
library(factoextra)
fviz_nbclust(brain_stroke, kmeans, method = "silhouette")
```

```{r}
#طريقة السلايدز حقت اللاب
# Define a function to compute average silhouette for k clusters using silhouette()
library(cluster)
silhouette_score <- function(k, data) {
  km <- kmeans(data, centers = k, nstart = 25)
  ss <- silhouette(km$cluster, dist(data))
  sil <- mean(ss[, 3])
  return(sil)
}

# Set the range of clusters (k values)
k_range <- 2:10

# Call the function for each k value and store the results in avg_sil
avg_sil <- sapply(k_range, silhouette_score, data = brain_stroke)

# Create a plot to visualize the Average Silhouette Scores
plot(k_range, avg_sil, type = 'b', xlab = 'Number of clusters', ylab = 'Average Silhouette Scores', frame = FALSE)



```

```{r}
#تكملة السلايدز حقت اللاب
# 2- silhouette method
install.packages("NbClust")
library(NbClust)
#a)fviz_nbclust() with silhouette method using library(factoextra) 
fviz_nbclust(USArrests, kmeans, method = "silhouette")+
  labs(subtitle = "Silhouette method")
#b) NbClust validation
fres.nbclust <- NbClust(brain_stroke, distance="euclidean", min.nc = 2, max.nc = 10, method="kmeans", index="all")



```
